//____________________________________________________________________________________________________________________________________________________________________________

//–ü–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ !!!!

//. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å–º–∞
//   ¬∑ –ü—Ä–∏ –≤–≤–æ–¥–µ –≤ –ø–æ–ª–µ –∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ (–∏–ª–∏ Enter) —Ñ–∏–ª—å–º –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫ ¬´–ö –ø—Ä–æ—Å–º–æ—Ç—Ä—É¬ª.
//   ¬∑ –ü–æ–ª–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.
//2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
//   ¬∑ –ö–∞–∂–¥—ã–π —Ñ–∏–ª—å–º –∏–º–µ–µ—Ç –¥–≤–µ –∫–Ω–æ–ø–∫–∏: ¬´–æ—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–º¬ª (–≥–ª–∞–∑) –∏ ¬´—É–¥–∞–ª–∏—Ç—å¬ª (–∫—Ä–µ—Å—Ç–∏–∫).
//   ¬∑ –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –≥–ª–∞–∑ —Ñ–∏–ª—å–º –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫ ¬´–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ¬ª, –º–µ–Ω—è–µ—Ç —Å—Ç–∏–ª—å (–∑–∞—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ).
//   ¬∑ –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫ —Ñ–∏–ª—å–º —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ª—é–±–æ–≥–æ —Å–ø–∏—Å–∫–∞.
//3. Drag&Drop
//   ¬∑ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–æ–≤ –º–µ–∂–¥—É —Å–ø–∏—Å–∫–∞–º–∏.
//   ¬∑ –í–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å—Å—è (opacity, transform).
//   ¬∑ –ü—Ä–∏ –±—Ä–æ—Å–∞–Ω–∏–∏ –≤ –¥—Ä—É–≥–æ–π —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è —Ç—É–¥–∞ –∏ –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å.
//4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
//   ¬∑ –í –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ –∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö —Å–ø–∏—Å–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å—á—ë—Ç—á–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
//   ¬∑ –í—Å–µ–≥–æ —Ñ–∏–ª—å–º–æ–≤ / –ö –ø—Ä–æ—Å–º–æ—Ç—Ä—É / –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ.
//5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
//   ¬∑ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Å—ë –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–æ—Å—å.
//6. –î–µ—Ç–∞–ª–∏
//   ¬∑ –£—á—Ç–∏, —á—Ç–æ —Å–ø–∏—Å–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
//   ¬∑ –û–±—Ä–∞–±–æ—Ç–∞–π –ø–æ–ø—ã—Ç–∫—É –¥–æ–±–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–π —Ñ–∏–ª—å–º.
//   ¬∑ –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–æ–¥—É–ª—å–Ω—ã–º, –±–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ window.
//   ¬∑ –ò—Å–ø–æ–ª—å–∑—É–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π JavaScript (ES6+).

//____________________________________________________________________________________________________________________________________________________________________________

//____________________________________________________________________________________________________________________________________________________________________________

// –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–æ–≤ , —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –Ω–∏—Ö —Å–ª—É—à–∞—Ç–µ–ª—è —Å–æ–±—ã—Ç–∏–π

let moviesListToWatch = [];
let moviesListToWatched = [];
let targetForDD = null;
const inputEl = document.querySelector("#movieInput");
const moviesListToWatchEl = document.querySelector("#pendingList"); //!!!!!!!!!!!!!!!!!!!
const moviesListToWatchedEl = document.querySelector("#watchedList"); //!!!!!!!!!!!!!!!!!!!
const buttonAddMovie = document.querySelector("#addButton");
const btnDeleteMovie = document.querySelector(".delete-btn");

let movieName = "";

inputEl.addEventListener("input", onInputMovie);
buttonAddMovie.addEventListener("click", onAddMovie);
moviesListToWatchEl.addEventListener("click", onhandleclick);
moviesListToWatchedEl.addEventListener("click", onhandleclick);

//____________________________________________________________________________________________________________________________________________________________________________

//____________________________________________________________________________________________________________________________________________________________________________

moviesListToWatchEl.addEventListener("drop", drop);
moviesListToWatchedEl.addEventListener("drop", drop);
moviesListToWatchEl.addEventListener("dragover", (e) => e.preventDefault());
moviesListToWatchedEl.addEventListener("dragover", (e) => e.preventDefault());


function drop(event) {
    event.preventDefault();
  if (targetForDD) {
    const movieId = targetForDD.dataset.id
    
    if (this.id=== "pendingList") {
      moveMovieTo(movieId, moviesListToWatch, moviesListToWatched);
    }
     else if (this.id === "watchedList") {
       moveMovieTo(movieId, moviesListToWatched, moviesListToWatch);
     }
  }
  renderAll();
}

  function moveMovieTo(movieId, targetArray, sourceArray) {
    const index = sourceArray.findIndex((movie) => movie.id === movieId);

    const movie = sourceArray.splice(index, 1)[0];
    movie.watched = targetArray === moviesListToWatched;
    targetArray.push(movie);
  }

function addDragAndDrop() {
  const targets = document.querySelectorAll(".movie-item");

  for (const target of targets) {
    target.addEventListener("dragstart", dragStart);
    target.addEventListener("dragend", dragEnd);

    function dragStart() {
      targetForDD = this;
      this.classList.add("dragging");
      console.log(targetForDD);
    }
    function dragEnd() {
      this.classList.remove("dragging");
            targetForDD = null;
    }
  }
}

//____________________________________________________________________________________________________________________________________________________________________________

//____________________________________________________________________________________________________________________________________________________________________________

//   –î–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è renderAll - –æ–±–Ω–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤


loadFromLocalStorage(); 
renderAll();
function renderAll() {
  renderList(moviesListToWatched, moviesListToWatchedEl, true),
  renderList(moviesListToWatch, moviesListToWatchEl, false);

  renderOfAllCounters();
  addDragAndDrop();
    saveToLocalStorage();

}

// –†–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ –≤ –æ–¥–Ω–æ–π  —Ñ—É–Ω–∫—Ü–∏–∏
function renderOfAllCounters() {
  document.querySelector("#totalCount").textContent =
    moviesListToWatch.length + moviesListToWatched.length;
  document.querySelector("#pendingCount").textContent =
    moviesListToWatch.length;
  document.querySelector("#watchedCount").textContent =
    moviesListToWatched.length;
  document.querySelector("#pendingCounter").textContent =
    moviesListToWatch.length;
  document.querySelector("#watchedCounter").textContent =
    moviesListToWatched.length;
}

// –†–µ–Ω–¥–µ—Ä –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞ , –∏ container.innerHTML –≤ –¥–æ–∫—É–º–µ–Ω—Ç
function renderList(movies, container, isWatched) {
  const markup = movies.map(
    (movie) =>
      `<li class ="movie-item " data-id="${movie.id}" draggable="true">
      <span class = 'movie-title ${isWatched ? "watched" : ""}' > ${
        movie.name
      } </span>
      <div class="movie-actions">
                 <button class="action-btn watch-btn" data-action ="${
                   isWatched ? "unwatch" : "watch"
                 }" >
                     ${isWatched ? "‚Ü©Ô∏è" : "üëÅÔ∏è"}
                 </button>
                 <button class="action-btn delete-btn" data-action ='delete'>
                     üóëÔ∏è
                 </button>
             </div>
      </li>`
  );
  container.innerHTML = markup.join("");
  
}

//____________________________________________________________________________________________________________________________________________________________________________

function saveToLocalStorage() {
  const data = {
    watch: moviesListToWatch,
    watched: moviesListToWatched,
  };

  localStorage.setItem("movies", JSON.stringify(data));
}

function loadFromLocalStorage() {

  const data = localStorage.getItem("movies");

  if (!data) return;

  const parsed = JSON.parse(data);

  moviesListToWatch = parsed.watch;
  moviesListToWatched = parsed.watched;
}


//____________________________________________________________________________________________________________________________________________________________________________

// –î–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –î–µ–ª–µ–≥–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤  , –ª–æ–≤–∏—Ç –Ω–∞ –∫–∞–∫—É—é –∫–Ω–æ–ø–∫—É –≤–Ω—É—Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –±—ã–ª–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –∏ –≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –¥–µ–ª–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –¥–µ–π—Å–≤–∏—è
function onhandleclick(event) {
  const btn = event.target;

  const movieItem = btn.closest(".movie-item");
  const movieId = movieItem.dataset.id;
  const action = btn.dataset.action;

  if (action === "delete") {
    deleteMovie(movieId);
  } else if (action === "watch") {
    replaceMovieToWatched(movieId);
  } else if (action === "unwatch") {
    replaceBackMovieToWatch(movieId);
  }
}

function deleteMovie(movieId) {
  moviesListToWatch = moviesListToWatch.filter((movie) => movie.id !== movieId);
  moviesListToWatched = moviesListToWatched.filter(
    (movie) => movie.id !== movieId
  );
  renderAll();
}

function replaceMovieToWatched(movieId) {
  const index = moviesListToWatch.findIndex((movie) => movie.id === movieId);

  if (index !== -1) {
    const movie = moviesListToWatch.splice(index, 1)[0];
    movie.watched = true;
    moviesListToWatched.push(movie);
    renderAll();
  }
}

function replaceBackMovieToWatch(movieId) {
  const index = moviesListToWatched.findIndex((movie) => movie.id === movieId);

  if (index !== -1) {
    const movie = moviesListToWatched.splice(index, 1)[0];
    movie.watched = false;
    moviesListToWatch.push(movie);
    renderAll();
  }
}

//____________________________________________________________________________________________________________________________________________________________________________

//____________________________________________________________________________________________________________________________________________________________________________

// –¥–µ–ª–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å –∏–º–µ–Ω–µ–º  —Ñ–∏–ª—å–º–∞ –∫–æ—Ç–æ—Ä–æ–µ –≤–≤–æ–¥—è—Ç –≤ Input
function onInputMovie(event) {
  movieName = event.currentTarget.value;
}

// –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –∏–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è , –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –≤–≤–µ–¥—ë–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –≤ Input , –∏–º—è –Ω–µ –¥–æ–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫ –¥–ª—è –∂–µ–ª–∞–µ–º–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
function isDuplicateMovie(movieName) {
  const moviesLists = [...moviesListToWatch, ...moviesListToWatched];
  return moviesLists.some(
    (movie) => movie.name.toUpperCase() === movieName.toUpperCase()
  );
}

function onAddMovie() {
  if (movieName !== "") {
    if (isDuplicateMovie(movieName)) {
      inputEl.value = "";
      return;
    }

    const movie = {
      name: movieName,
      id: Date.now().toString(15) + Math.random().toString(15),
      watched: false,
    };

    moviesListToWatch.push(movie);
    inputEl.value = "";
    movieName = "";
    renderAll();
  }
}
//____________________________________________________________________________________________________________________________________________________________________________
